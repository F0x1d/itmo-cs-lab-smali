# Статья 2: ApkTool

Как же редактировать `.apk` файлы? В этом нам поможет утилита `ApkTool`, которую вам надо будет скачать. Это программа, которая объединяет утилиты, которые нужны для декомпиляции `Android` приложений

Для начала работы создайте какую-нибудь папку и поместите туда скачанный `apktool.jar` и наш `hackme.apk` (переименуйте файл `ApkTool`, так будет проще)

## Декомпиляция

Теперь необходимо открыть консоль в текущей папке и выполнить команду:
```bash
java -jar apktool.jar d hackme.apk
```

Теперь у нас появилась папка `hackme`, с которой мы уже можем работать. `ApkTool` декомпилировал наше приложение. Теперь мы уже можем просматривать ресурсы, код и все остальное

### Smali

Тут возникает вопрос... То есть можно просто использовать `ApkTool`, чтобы получить исходный код любого приложения?
На самом деле, конечно, нет. Вместо кода на `Java`/`Kotlin` вы увидите `.smali` файлы, это "человеко-читаемый" байт-код для `ART`, который мы сможем собрать обратно в `.dex` файлы

В следующих статьях как раз будет немного о `Smali`, но в этой статье мы затрагиваем лишь сам `ApkTool`

## Компиляция

Что же надо сделать, чтобы все собрать обратно? Запустить команду:
```bash
java -jar apktool.jar b hackme
```

Если все ок, то после выполнения вы найдете собранный файл в `hackme/dist`, иначе надо фиксить ошибки

## Подпись

Можете попробовать его себе установить (спойлер: ничего не выйдет). Для начала надо его подписать

Что это значит?
Если простым языком, то при подписывании содержимое `.apk` файла хешируется и хеши сохраняются в него же. Потом при установке `Android` проверяет эти хеши файлов

Так как мы что-то меняли, то хеши файлов точно поменялись, значит старая подпись уже не подходит, нужно подписать файл заново
Если вам лень создавать подпись, то можете взять [эту](../assets/key.jks), её данные:
- Все пароли: `itmoitmo`
- Alias: `itmo`

Разархивируем наши `build-tools` и поместим туда наш собранный `.apk` файл и саму подпись, затем откроем там терминал и выполним команды:
```bash
./zipalign -p 4 hackme.apk hackme-aligned.apk
./apksigner sign --ks-key-alias itmo --ks-pass pass:itmoitmo --key-pass pass:itmoitmo --ks key.jks hackme-aligned.apk
```

Тут мы используем новую утилиту: `zipalign`. Это инструмент выравнивания `zip`-архивов, который помогает гарантировать, что все несжатые файлы в архиве выровнены относительно начала файла. Это позволяет получать доступ к файлам напрямую через `mmap(2)`, устраняя необходимость копировать эти данные в оперативную память и уменьшая использование памяти вашим приложением.

После выполнения данных команд файл `hackme-aligned.apk` может быть установлен на любое устройство `Android`!

# Навигация

- [Задание](../README.md)
- [Статья 1: Android, приложения](./APPS.md)
- **Статья 2: ApkTool**
- [Статья 3: JADX](./JADX.md)
- [Статья 4: Основы Smali](./SMALI-BASIC.md)